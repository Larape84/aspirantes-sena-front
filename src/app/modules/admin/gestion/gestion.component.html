<section class="w-full flex flex-col">
    <div
        class="flex items-center sm:pl-16 gap-4 pl-4 pt-6 pb-4 relative rounded-b-3xl bg-white"
    >
        <div class="items-center flex overflow-hidden">
            <mat-icon
                class="icon-size-12 text-gray-700"
                svgIcon="heroicons_outline:chart-pie"
            ></mat-icon>
        </div>
        <div class="flex-1 mx-3">
            <div class="text-3xl font-semibold tracking-tight leading-8">
                Registros
            </div>
            <div class="flex items-center">
                <div class="font-medium tracking-tight text-secondary">
                    Módulo para gestionar los registros
                </div>
            </div>
        </div>
    </div>

    <div class="w-full paddingPrincipal">
        <div
            class="w-full bg-white rounded-lg overflow-hidden border border-gray-300"
        >
            <div
                class="flex md:flex-row flex-col w-full p-3 gap-3 items-center justify-between"
            >
                <div class="flex gap-4 w-full md:w-auto">
                    <button
                        (click)="openModal()"
                        type="button"
                        mat-raised-button
                        color="primary"
                    >
                        <mat-icon class="icon-size-7 text-gray-500">{{
                            "description"
                        }}</mat-icon>
                        <span class="ml-2">Subir registros </span>
                    </button>
                </div>

                <div class="flex gap-3 w-full md:w-auto">
                    <button
                        (click)="listarUsuarios()"
                        type="button"
                        mat-icon-button
                    >
                        <mat-icon class="icon-size-6 text-gray-600"
                            >settings_backup_restore</mat-icon
                        >
                    </button>

                    <button
                        (click)="descargarData()"
                        mat-icon-button
                        type="button"
                    >
                        <mat-icon class="icon-size-7 text-gray-600"
                            >cloud_download</mat-icon
                        >
                    </button>
                    <div
                        class="rounded-full widthSearch h-9 px-2 border border-gray-300 gap-2 flex items-center"
                    >
                        <mat-icon class="icon-size-6 text-gray-400"
                            >search</mat-icon
                        >
                        <input
                            (input)="filtrar(text.value)"
                            #text
                            type="text"
                            autocomplete="off"
                            placeholder="Filtrar..."
                            class="w-full uppercase text-gray-600"
                        />
                    </div>
                </div>
            </div>

            <div class="w-full border-b border-gray-300">
                <div *ngIf="viewMode === 'XSmall'" class="w-full pb-3">
                    <div class="w-full border border-gray-100 rounded-md">
                        <div
                            class="w-full overflow-y-auto max-h-128 scroll flex flex-col gap-2 px-2 py-2"
                        >
                            <div
                                *ngFor="let item of dataSource.filteredData"
                                class="border snapt-center border-gray-100 rounded-md bg-gray-50 p-2 flex flex-col gap-2"
                            >
                                <div class="flex flex-col gap-2">
                                    <div class="font-semibold text-gray-700">
                                        Nro de documento :
                                    </div>
                                    <div class="text-gray-600">
                                        {{ item.id }}
                                    </div>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <div class="font-semibold text-gray-700">
                                        Nombres :
                                    </div>
                                    <div class="text-gray-600">
                                        {{ item.nombre }}
                                    </div>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <div class="font-semibold text-gray-700">
                                        Apellidos :
                                    </div>
                                    <div class="text-gray-600">
                                        {{ item.apellido }}
                                    </div>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <div class="font-semibold text-gray-700">
                                        Cargo :
                                    </div>
                                    <div class="text-gray-600">
                                        {{ item.cargo }}
                                    </div>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <div class="font-semibold text-gray-700">
                                        Centro :
                                    </div>
                                    <div class="text-gray-600">
                                        {{ item.centroCosto }}
                                    </div>
                                </div>

                                <div
                                    class="flex flex-row gap-2 items-center justify-between"
                                >
                                    <div class="font-semibold text-gray-700">
                                        Activo
                                    </div>
                                    <mat-slide-toggle
                                        [(ngModel)]="item.activo"
                                        (change)="
                                            cambiarEstadoDependencia(item)
                                        "
                                        color="primary"
                                    >
                                    </mat-slide-toggle>
                                </div>

                                <div
                                    class="flex flex-row gap-2 items-center justify-between"
                                >
                                    <div class="font-semibold text-gray-700">
                                        Codigo Qr
                                    </div>
                                    <mat-slide-toggle
                                        [(ngModel)]="
                                            item.permisos[0].access.usuario
                                        "
                                        (change)="
                                            cambiarEstadoDependencia(item)
                                        "
                                        color="primary"
                                    >
                                    </mat-slide-toggle>
                                </div>

                                <div
                                    class="flex flex-row gap-2 items-center justify-between"
                                >
                                    <div class="font-semibold text-gray-700">
                                        Restaurant
                                    </div>
                                    <mat-slide-toggle
                                        [(ngModel)]="
                                            item.permisos[0].access.gestor
                                        "
                                        (change)="
                                            cambiarEstadoDependencia(item)
                                        "
                                        color="primary"
                                    >
                                    </mat-slide-toggle>
                                </div>

                                <div
                                    class="flex flex-row gap-2 items-center justify-between"
                                >
                                    <div class="font-semibold text-gray-700">
                                        Admin
                                    </div>
                                    <mat-slide-toggle
                                        [(ngModel)]="
                                            item.permisos[0].access.admin
                                        "
                                        (change)="
                                            cambiarEstadoDependencia(item)
                                        "
                                        color="primary"
                                    >
                                    </mat-slide-toggle>
                                </div>
                            </div>

                            <div
                                class="w-full"
                                *ngIf="!dataSource.filteredData.length"
                            >
                                <div class="mat-cell text-center" colspan="21">
                                    <div
                                        class="w-full"
                                        *ngIf="!dataSource.filteredData.length"
                                    >
                                        <div
                                            class="flex items-center content-center justify-center mt-7 gap-3"
                                        >
                                            <mat-icon
                                                svgIcon="heroicons_outline:information-circle"
                                            ></mat-icon>
                                            <p
                                                class="text-5xl font-semibold tracking-tight"
                                            >
                                                {{ "Aviso" }}
                                            </p>
                                        </div>
                                        <p class="text-lg mb-8">
                                            {{
                                                "Lo sentimos, no se encontraron datos"
                                            }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    *ngIf="viewMode !== 'XSmall'"
                    class="w-full xl:max-h-128 lg:max-h-100 overflow-y-auto"
                >
                    <table mat-table [dataSource]="dataSource">
                        <ng-container matColumnDef="convocatoria">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                class="bg-gray-100"
                            >
                                Convocatoria
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.convocatoria }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="vigencia">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                class="bg-gray-100"
                            >
                                Vigencia
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.vigencia }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="centroFormacion">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                class="bg-gray-100"
                            >
                                Centro de formación
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.centroFormacion }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="usuario">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                class="bg-gray-100"
                            >
                                Usuario
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.user.nombres }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="fechaCreacion">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                class="bg-gray-100"
                            >
                                Fecha creación
                            </th>
                            <td mat-cell *matCellDef="let element">
                                {{ element.fecha | dataTable : "date" }}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="estado">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                class="bg-gray-100 text-center"
                            >
                                Registros
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <div
                                    class="flex items-center gap-2 justify-center"
                                >
                                    {{ element.registros }}

                                    <button
                                        (click)="visualizarRegistros(element)"
                                        mat-icon-button
                                        type="button"
                                    >
                                        <mat-icon>remove_red_eye</mat-icon>
                                    </button>
                                </div>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="registros">
                            <th
                                mat-header-cell
                                *matHeaderCellDef
                                class="bg-gray-100"
                            >
                                <div class="text-center sticky -top-0.5 z-99">
                                    Estado
                                </div>
                            </th>
                            <td mat-cell *matCellDef="let element">
                                <div
                                    class="w-full flex items-center justify-center"
                                >
                                    <!-- <mat-slide-toggle (change)="cambiarEstadoDependencia(element)" [(ngModel)]="element.status"></mat-slide-toggle> -->
                                    <p-inputSwitch
                                        styleClass="scale"
                                        [disabled]="
                                            !user.permisos[0].access.admin
                                        "
                                        (onChange)="
                                            cambiarEstadoDependencia(element)
                                        "
                                        [(ngModel)]="element.estado"
                                    />
                                </div>
                            </td>
                        </ng-container>

                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell text-center" colspan="21">
                                <div
                                    class="w-full h-40 flex flex-col gap-4 items-center justify-center"
                                >
                                    <div
                                        class="flex items-center content-center justify-center mt-7 gap-3"
                                    >
                                        <mat-icon
                                            svgIcon="heroicons_outline:information-circle"
                                        ></mat-icon>
                                        <p
                                            class="text-5xl font-semibold tracking-tight"
                                        >
                                            {{ "Aviso" }}
                                        </p>
                                    </div>
                                    <p class="text-lg mb-8">
                                        {{
                                            "Lo sentimos, no se encontraron datos "
                                        }}
                                    </p>
                                </div>
                            </td>
                        </tr>

                        <tr
                            mat-header-row
                            *matHeaderRowDef="displayedColumns"
                            class="border-t border-gray-300 sticky -top-0.5 border-b"
                        ></tr>
                        <tr
                            mat-row
                            *matRowDef="let row; columns: displayedColumns"
                        ></tr>
                    </table>
                </div>
            </div>

            <mat-paginator> </mat-paginator>
        </div>
    </div>
</section>
